# 递归判断规则

## 核心原则

> 递归判断基于 **代码逻辑的内聚性与关联关系**，不设机械的深度限制。
> 目标是让每个摘要单元对应一个有意义的功能边界。

## 判断流程

对每个子目录，依次评估以下条件：

### 1. 是否在跳过列表中？

参照 `skip_patterns.md`，如果目录匹配跳过规则，直接跳过。

### 2. 是否有 Assembly Definition？

如果子目录包含 `.asmdef` 文件，说明它被显式定义为一个独立编译单元：
- ✅ **递归**，生成独立的目录摘要
- 分析 `.asmdef` 文件中声明的依赖，记录模块间关系

### 3. 与父目录的逻辑关系？

分析子目录中代码的命名空间、类的继承关系和调用模式：

#### 3a. 属于同一功能模块
**特征**：
- 共享相同或相近的命名空间（如 `Game.UI` 和 `Game.UI.Panels`）
- 子目录中的类大量继承或实现父目录中的基类/接口
- 属于同一个工作流的不同环节（如 `Input/` 下的 `Handlers/` 和 `Mappings/`）

**处理方式**：递归分析，但将内容**合并到父目录的摘要中**，作为子节展示

#### 3b. 构成独立子系统
**特征**：
- 拥有独立的命名空间
- 对外暴露明确的入口类 / API，内部实现相对封闭
- 文件数量 ≥ 5 个，有自己的内部结构
- 例如：`AI/BehaviorTree/`、`Networking/Sync/`、`Audio/SoundSystem/`

**处理方式**：递归分析，生成**独立的目录摘要**

#### 3c. 薄封装 / 工具层
**特征**：
- 只有 1-2 个简单文件
- 主要是转发调用、适配器、或工具类
- 不构成独立的逻辑单元

**处理方式**：不单独递归，在**父目录摘要中简要提及**

### 4. 命名约定暗示

某些目录名暗示了它的递归策略：

| 目录名模式                           | 默认策略                  | 说明               |
| ------------------------------------ | ------------------------- | ------------------ |
| `Core/`、`Framework/`、`Base/`       | 独立摘要                  | 通常是项目核心框架 |
| `UI/`、`Views/`、`Panels/`           | 合并到父级 + 按子功能拆分 | UI 通常有多层嵌套  |
| `Utils/`、`Helpers/`、`Extensions/`  | 合并到父级                | 工具类通常内聚性低 |
| `Models/`、`Data/`、`Configs/`       | 合并到父级                | 数据定义通常简单   |
| `Tests/`、`Editor/`                  | 独立摘要（概要级别）      | 非运行时代码       |
| `ThirdParty/`、`Vendor/`、`Plugins/` | 跳过或仅记录              | 第三方代码         |

> **注意**：命名约定仅作为初始判断的参考，最终决策必须结合代码实际内容。

## 合并 vs 独立摘要的选择标准

| 维度          | 合并到父级               | 独立摘要                   |
| ------------- | ------------------------ | -------------------------- |
| 文件数量      | ≤ 4 个脚本               | ≥ 5 个脚本                 |
| 命名空间      | 与父级相同或为子命名空间 | 完全独立的命名空间         |
| 对外依赖      | 主要被父级代码使用       | 被多个不同模块引用         |
| 内部复杂度    | 逻辑简单、职责单一       | 有自己的内部架构和设计模式 |
| Assembly 边界 | 无 .asmdef               | 有 .asmdef                 |

## 特殊情况

### 循环依赖
如果发现两个目录之间存在循环依赖（A 引用 B，B 也引用 A），应在两个目录的摘要中都标注这一情况，并在备注中记录为潜在的架构问题。

### 超大目录
如果单个目录下有大量脚本（> 20 个），即使逻辑内聚，也建议按子功能分组描述，在摘要中使用子标题组织。

### Partial Classes
如果一个类通过 `partial` 关键字分布在多个文件中，应在摘要中将它们作为一个整体描述，注明各部分所在文件。
